# 워커 프로세스가 실행될 리눅스 사용자 (보안 위해 root 대신 nginx 계정 사용)
user nginx;

# CPU 코어 수에 맞춰 워커 프로세스 자동 생성 (성능 최적화)
worker_processes auto;

# 에러 로그 파일 경로 및 로그 레벨 (warn 이상만 기록)
error_log /var/log/nginx/error.log warn;

# Nginx 마스터 프로세스의 PID 파일 위치
pid /var/run/nginx.pid;

events {
    # 각 워커 프로세스가 동시에 처리할 수 있는 최대 연결 수
    worker_connections 1024;
}

http {
    # MIME 타입 정의 파일 포함 (확장자 → Content-Type 매핑)
    include /etc/nginx/mime.types;

    # MIME 타입을 알 수 없는 경우 기본값 (binary)
    default_type application/octet-stream;

    # 로그 출력 형식 정의 (main이라는 포맷 이름으로 저장)
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

    # 접근 로그 파일 경로와 사용할 로그 포맷 지정
    access_log /var/log/nginx/access.log main;

    # 파일 전송 시 sendfile() 시스템콜 사용 (성능 향상)
    sendfile on;

    # TCP 패킷을 모아 헤더와 데이터 함께 전송 (전송 효율 ↑)
    tcp_nopush on;

    # 작은 TCP 패킷도 지연 없이 즉시 전송 (지연 ↓)
    tcp_nodelay on;

    # Keep-Alive 연결 유지 시간(초)
    keepalive_timeout 65;

    # MIME 타입 해시 테이블 크기 (많은 타입 처리 시 성능 ↑)
    types_hash_max_size 2048;


    # conf.d 폴더 안의 모든 .conf 파일을 포함 (여기에 server {} 블록 작성)
    include /etc/nginx/conf.d/*.conf;
}
